<!DOCTYPE html>
<html>
<head>
  <title>Crossway Live Chat</title>
  <style>
    body { font-family: Arial; background:#f2f7fa; margin:0; padding:0; }
    #chatbox {
      height: 400px; overflow-y: auto; background:white;
      border:1px solid #ccc; margin:20px; padding:10px; border-radius:6px;
    }
    #msgInput { width:70%; padding:10px; font-size:16px; }
    #sendBtn { padding:10px 20px; font-size:16px; }

    /* ===== ADMIN PANEL ===== */
    #adminPanel {
      display:none; background:#eef6ff; padding:20px; margin:20px;
      border-radius:6px; border:1px solid #b7d6ff;
    }
    .adminBtn {
      padding:10px 18px; font-size:16px; margin:6px;
      cursor:pointer; background:#3f76ff; color:white; border:none; border-radius:4px;
    }
    .resetBtn {
      background:#d9534f;
    }
  </style>
</head>
<body>

  <h2 style="text-align:center; margin-top:18px;">ðŸ“¡ Crossway Live Chat</h2>

  <div id="chatbox"></div>

  <!-- Public Send -->
  <div style="text-align:center;">
    <input id="msgInput" placeholder="Write a message..." />
    <button id="sendBtn">Send</button>
  </div>

  <br><br>

  <!-- Toggle Admin -->
  <center>
    <button onclick="toggleAdmin()">ðŸ”§ Admin Controls</button>
  </center>

  <!-- ADMIN SECTION -->
  <div id="adminPanel">

    <h3>Admin Panel</h3>

    <button class="adminBtn resetBtn" onclick="resetChat()">ðŸ§¹ Reset Chat</button><br><br>

    <input id="adminMsg" placeholder="Host message..." style="width:70%; padding:10px;" />
    <button class="adminBtn" onclick="sendHost()">Send as Host</button>

  </div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
const socket = io();
const chatbox = document.getElementById("chatbox");

// Load message history
socket.on("chat-history", msgs => msgs.forEach(addMsg));

// Display new messages live
socket.on("chat-message", addMsg);

socket.on("chat-cleared", ()=>{
  chatbox.innerHTML = "";
});

// Push to DOM
function addMsg(msg){
  const div = document.createElement("div");
  div.style.marginBottom = "10px";

  if(msg.author === "Host"){
    div.innerHTML = `<b style="color:#d9534f;">Host:</b> ${msg.text}`;
  } else {
    div.innerHTML = `<b>${msg.author || "User"}:</b> ${msg.text}`;
  }

  chatbox.appendChild(div);
  chatbox.scrollTop = chatbox.scrollHeight;
}

// Public send
document.getElementById("sendBtn").onclick = ()=>{
  const text = msgInput.value.trim();
  if(!text) return;
  socket.emit("chat-message",{author:"User", text});
  msgInput.value="";
};

// ===== ADMIN FUNCTIONS =====
function toggleAdmin(){
  const panel = document.getElementById("adminPanel");
  panel.style.display = panel.style.display === "none" ? "block" : "none";
}

function resetChat(){
  fetch("/admin/reset",{method:"POST"})
  .then(()=>alert("Chat Reset"));
}

function sendHost(){
  const text = adminMsg.value.trim();
  if(!text) return alert("Enter a message");
  
  fetch("/admin/send",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({text})
  }).then(()=>{
    alert("Sent as Host");
    adminMsg.value="";
  });
}
</script>
</body>
</html>
